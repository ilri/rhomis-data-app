(this["webpackJsonprhomis-data-manager"]=this["webpackJsonprhomis-data-manager"]||[]).push([[0],{105:function(e,t,a){},131:function(e,t,a){},151:function(e,t,a){},160:function(e,t,a){},164:function(e,t,a){},177:function(e,t){},179:function(e,t){},200:function(e,t,a){},201:function(e,t,a){},204:function(e,t,a){},205:function(e,t,a){},207:function(e,t,a){},208:function(e,t,a){"use strict";a.r(t);var r=a(2),n=a.n(r),c=a(33),s=a.n(c),o=(a(131),a(5)),i=(a(60),a(132),a(13)),l=a.n(i),d=a(4),j=a(9),u=a(226),b=a(222),h=a(120),m=a(218),p=a(52),O=a(71),f=a(11),x=(a(151),Object(r.createContext)()),g=a(17),v=a(1);function w(e){return null===e.email|""===e.email?(g.Store.addNotification({title:"User Error",message:"Must include email",type:"danger",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"],dismiss:{duration:2e3}}),!1):!(null===e.password|""===e.password)||(g.Store.addNotification({title:"User Error",message:"Must password",type:"danger",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"],dismiss:{duration:2e3}}),!1)}function y(e){var t=Object(r.useContext)(x),a=Object(o.a)(t,2),n=(a[0],a[1]),c=Object(f.g)(),s=Object(r.useState)(""),i=Object(o.a)(s,2),l=i[0],p=i[1],g=Object(r.useState)(""),w=Object(o.a)(g,2),y=w[0],S=w[1],N=Object(r.useState)(""),_=Object(o.a)(N,2),T=_[0],D=_[1],C=Object(r.useState)(""),F=Object(o.a)(C,2),I=F[0],L=F[1];return Object(r.useEffect)((function(){var e=localStorage.getItem("userToken"),t=new Date,a=new Date(localStorage.getItem("createdAt"));if(t.getTime()-a.getTime()<36e5)return n(e),void c.push("/")}),[]),Object(v.jsxs)(u.a,{className:"card-style border-0 login-card",children:[Object(v.jsx)(u.a.Header,{className:"bg-dark text-white",children:Object(v.jsx)("h2",{children:"Login"})}),Object(v.jsxs)(u.a.Body,{children:[Object(v.jsx)("div",{className:"icon-container",children:Object(v.jsx)(O.a,{size:60})}),Object(v.jsxs)(b.a,{style:{marginLeft:"2em",marginRight:"2em"},children:[Object(v.jsxs)(b.a.Group,{className:"form-group-spaced",children:[Object(v.jsx)(b.a.Label,{htmlFor:"email",children:"Email"}),Object(v.jsx)(b.a.Control,{id:"email",type:"text",onChange:function(e){return p(e.target.value)}})]}),Object(v.jsxs)(b.a.Group,{className:"form-group-spaced",children:[Object(v.jsx)(b.a.Label,{htmlFor:"password",children:"Password"}),Object(v.jsx)(b.a.Control,{type:"password",onChange:function(e){return S(e.target.value)}})]}),T?Object(v.jsx)("p",{className:"warning",children:T}):null,Object(v.jsx)("div",{className:"button-container",children:I?Object(v.jsxs)(h.a,{className:"login-buttons",variant:"dark",children:[Object(v.jsx)(m.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),"Loading"]}):Object(v.jsx)(h.a,{className:"login-buttons",type:"submit",variant:"dark",onClick:function(){var e=Object(j.a)(Object(d.a)().mark((function e(t){var a,r;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return L(!0),e.next=3,k({event:t,email:l,password:y,requestError:T,setRequestError:D});case 3:if(a=e.sent,L(!1),400!==a.status){e.next=8;break}return c.push("/login"),e.abrupt("return");case 8:200===a.status&&(n(a.data),localStorage.setItem("userToken",a.data),r=new Date,localStorage.setItem("createdAt",r),c.push("/"));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:"Login"})}),Object(v.jsxs)("div",{style:{textAlign:"center",width:"100%"},children:["Don't have an account?\xa0",Object(v.jsx)("a",{href:"/#/register",children:"Click here"})," for registration"]})]})]})]})}function k(e){return S.apply(this,arguments)}function S(){return(S=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.event.preventDefault(),t.setRequestError(null),0!=w({email:t.email,password:t.password})){e.next=5;break}return e.abrupt("return",{status:400,message:"Missing Credentials"});case 5:return e.prev=5,e.next=8,l()({method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/user/login",data:{email:t.email,password:t.password}});case 8:return a=e.sent,e.abrupt("return",a);case 12:return e.prev=12,e.t0=e.catch(5),g.Store.addNotification({title:"Error",message:e.t0.response.data,type:"danger",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"],dismiss:{duration:2e3}}),e.abrupt("return",e.t0.response);case 16:case"end":return e.stop()}}),e,null,[[5,12]])})))).apply(this,arguments)}function N(e){var t=Object(r.useState)(!1),a=Object(o.a)(t,2),n=a[0],c=a[1];return Object(r.useEffect)((function(){c(!0)}),[]),Object(v.jsx)(p.a,{in:n,children:Object(v.jsx)("div",{className:"child-login-container",children:Object(v.jsx)(y,{})})})}var _=a(219),T=a(119),D=(a(160),a(124)),C=a(121),F=a.n(C);a(161);function I(e){return L.apply(this,arguments)}function L(){return(L=Object(j.a)(Object(d.a)().mark((function e(t){var a,r,n,c;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=!1,r=!1,!0===t.getSubmissionCount&&(a=!0,r=t.projectName),!t.authToken){e.next=14;break}return e.prev=4,e.next=7,l()({method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/meta-data/",data:{getSubmissionCount:a,projectName:r},headers:{Authorization:t.authToken}});case 7:n=e.sent,c=JSON.parse(JSON.stringify(n.data)),t.setUserInfo(c),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(4);case 14:case"end":return e.stop()}}),e,null,[[4,12]])})))).apply(this,arguments)}function A(e){var t=localStorage.getItem("userToken");if(!t)return e.setAuthToken(null),!1;var a=new Date,r=new Date(localStorage.getItem("createdAt")),n=a.getTime()-r.getTime();return n<36e5?(e.setAuthToken(t),!0):n>36e5&&(e.setAuthToken(null),!1)}function P(e){return E.apply(this,arguments)}function E(){return(E=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l()({method:"post",url:"https://api.rhomis.cgiar.org/\rapi/project-data",headers:{Authorization:t.authToken},data:{projectName:t.projectName,formName:t.formName}});case 2:200===(a=e.sent).status&&t.setFormData(a.data),400===a.status&&alert(a.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return R.apply(this,arguments)}function R(){return(R=Object(j.a)(Object(d.a)().mark((function e(t){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I({authToken:t.authToken,setUserInfo:t.setUserInfo});case 2:return e.next=4,P({authToken:t.authToken,projectName:t.projectName,formName:t.formName,setFormData:t.setFormData});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e){return null===e.email?(e.setRequestError("No email given"),!1):null!==e.password||(e.setRequestError("No password given"),!1)}function M(e){var t=Object(r.useState)(""),a=Object(o.a)(t,2),n=a[0],c=a[1],s=Object(r.useState)(""),i=Object(o.a)(s,2),l=i[0],p=i[1],O=Object(r.useState)(""),x=Object(o.a)(O,2),g=x[0],w=x[1],y=Object(r.useState)(""),k=Object(o.a)(y,2),S=k[0],N=k[1],C=Object(r.useState)(""),I=Object(o.a)(C,2),L=I[0],A=I[1],P=Object(r.useState)(""),E=Object(o.a)(P,2),U=E[0],R=E[1],B=Object(r.useState)(""),M=Object(o.a)(B,2),G=M[0],V=M[1],H=Object(r.useState)(!1),q=Object(o.a)(H,2),K=q[0],W=q[1],J=Object(r.useState)(null),Y=Object(o.a)(J,2),X=Y[0],Q=Y[1],Z=Object(r.useState)(null),$=Object(o.a)(Z,2),ee=$[0],te=$[1],ae=Object(f.g)(),re=l===g,ne=l.length>0&&g.length>0,ce=S===L,se=S.length>0&&L.length>0,oe=!0;return re&&ne&&ce&&se&&n.length>0&&U.length>0&&G.length>0&&ee&&(oe=!1),Object(v.jsxs)(u.a,{className:"card-style border-0 registration-card",children:[Object(v.jsx)(u.a.Header,{className:"bg-dark text-white",children:Object(v.jsx)("h2",{children:"Signup"})}),Object(v.jsx)(u.a.Body,{children:Object(v.jsxs)(b.a,{style:{marginLeft:"3em",marginRight:"3em"},children:[Object(v.jsxs)(_.a,{children:[Object(v.jsx)(T.a,{xs:3,children:Object(v.jsxs)(b.a.Group,{className:"form-group-spaced",children:[Object(v.jsx)(b.a.Label,{htmlFor:"email",children:"Title"}),Object(v.jsxs)(b.a.Select,{id:"title",defaultValue:"Select",onChange:function(e){return c(e.target.value)},children:[Object(v.jsx)("option",{disabled:"true",children:"Select"}),Object(v.jsx)("option",{value:"ms",children:"Ms"}),Object(v.jsx)("option",{value:"misss",children:"Miss"}),Object(v.jsx)("option",{value:"mrs",children:"Mrs"}),Object(v.jsx)("option",{value:"dr",children:"Dr"}),Object(v.jsx)("option",{value:"mr",children:"Mr"}),Object(v.jsx)("option",{value:"mx",children:"Mx"})]})]})}),Object(v.jsx)(T.a,{xs:4,children:Object(v.jsxs)(b.a.Group,{className:"form-group-spaced",children:[Object(v.jsx)(b.a.Label,{htmlFor:"name",children:"First Name"}),Object(v.jsx)(b.a.Control,{id:"name",type:"text",onChange:function(e){return R(e.target.value)}})]})}),Object(v.jsx)(T.a,{xs:5,children:Object(v.jsxs)(b.a.Group,{className:"form-group-spaced",children:[Object(v.jsx)(b.a.Label,{htmlFor:"surname",children:"Surname"}),Object(v.jsx)(b.a.Control,{id:"surname",type:"text",onChange:function(e){return V(e.target.value)}})]})})]}),Object(v.jsxs)(_.a,{children:[Object(v.jsx)(T.a,{children:Object(v.jsxs)(b.a.Group,{className:"form-group-spaced",children:[Object(v.jsx)(b.a.Label,{htmlFor:"email",children:"Email"}),Object(v.jsx)(b.a.Control,{id:"email",type:"text",onChange:function(e){return N(e.target.value)}})]})}),Object(v.jsxs)(T.a,{children:[Object(v.jsxs)(b.a.Group,{className:"form-group-spaced",children:[Object(v.jsx)(b.a.Label,{htmlFor:"email",children:"Confirm Email"}),Object(v.jsx)(b.a.Control,{id:"confirmemail",type:"text",onChange:function(e){return A(e.target.value)}})]}),se?Object(v.jsx)(b.a.Text,{style:{textAlign:"end"},children:ce?"Emails match":"Emails don't match"}):Object(v.jsx)(v.Fragment,{})]})]}),Object(v.jsxs)(_.a,{children:[Object(v.jsxs)(T.a,{children:[Object(v.jsxs)(b.a.Group,{className:"form-group-spaced",children:[Object(v.jsx)(b.a.Label,{htmlFor:"password",children:"Password"}),Object(v.jsx)(b.a.Control,{type:"password",onChange:function(e){p(e.target.value)}})]}),Object(v.jsx)(F.a,{password:l})]}),Object(v.jsx)(T.a,{children:Object(v.jsxs)(b.a.Group,{className:"form-group-spaced",children:[Object(v.jsx)(b.a.Label,{htmlFor:"password",children:"Confirm Password"}),Object(v.jsx)(b.a.Control,{type:"password",onChange:function(e){w(e.target.value)}}),ne?Object(v.jsx)(b.a.Text,{style:{textAlign:"end"},children:re?"Passwords match":"Passwords don't match"}):Object(v.jsx)(v.Fragment,{})]})})]}),X?Object(v.jsx)("p",{className:"warning",children:X}):null,Object(v.jsx)("div",{className:"icon-container",children:Object(v.jsx)(D.a,{sitekey:"6LfXLTsdAAAAAOqMXGb9rOqoIpGGPJN9HjcyoUYp\r",onChange:function(){var e=Object(j.a)(Object(d.a)().mark((function e(t){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:te(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})}),Object(v.jsx)("div",{className:"button-container",children:K?Object(v.jsxs)(h.a,{className:"login-buttons",variant:"dark",children:[Object(v.jsx)(m.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),"Loading..."]}):Object(v.jsx)(h.a,{disabled:oe,className:"login-buttons",variant:"dark",onClick:function(){var e=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W(!0),e.next=3,z({event:t,title:n,firstName:U,surname:G,email:S,password:l,captchaToken:ee,requestError:X,setRequestError:Q});case 3:a=e.sent,W(!1),(a.status>199||a.status<300)&&ae.push("/#/login");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:"Register"})}),Object(v.jsxs)("div",{style:{textAlign:"center",width:"100%"},children:["Already got an account?\xa0",Object(v.jsx)("a",{href:"/#/login",children:"Click here"})," for login"]})]})})]})}function z(e){return G.apply(this,arguments)}function G(){return(G=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.event.preventDefault(),t.setRequestError(null),B({title:t.title,firstName:t.firstName,surname:t.surname,email:t.email,password:t.password,requestError:t.requestError,setRequestError:t.setRequestError,captchaToken:t.captchaToken}),e.prev=3,e.next=6,l()({method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/user/register",data:{title:t.title,firstName:t.firstName,surname:t.surname,email:t.email,password:t.password,captchaToken:t.captchaToken}});case 6:return a=e.sent,e.abrupt("return",a);case 10:return e.prev=10,e.t0=e.catch(3),t.setRequestError(e.t0.response.data),e.abrupt("return",e.t0.response);case 14:case"end":return e.stop()}}),e,null,[[3,10]])})))).apply(this,arguments)}function V(e){var t=Object(r.useState)(!1),a=Object(o.a)(t,2),n=a[0],c=a[1],s=Object(r.useContext)(x),i=Object(o.a)(s,2),l=i[0],u=i[1];Object(f.g)();return Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u(null),localStorage.clear();case 2:case"end":return e.stop()}}),e)}))),[]),Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c(!0);case 1:case"end":return e.stop()}}),e)}))),[l]),Object(v.jsx)(p.a,{in:n,children:Object(v.jsx)("div",{className:"child-login-container",children:Object(v.jsx)(M,{})})})}var H=a(25),q=a(39),K=a(32);function W(e,t){t.children;return Object(v.jsx)("div",{className:"sub-page-container",children:Object(v.jsxs)(u.a,{className:"main-card border-0",children:[Object(v.jsx)(u.a.Header,{className:"bg-dark text-white",children:Object(v.jsxs)("div",{className:"main-card-header-container",children:[Object(v.jsx)("a",{href:"https://rhomis.github.io/rhomis-docs/"+e.doc_extension,target:"_blank",children:Object(v.jsx)(h.a,{className:"bg-dark border-0",children:Object(v.jsx)(q.a,{size:30,style:{color:"white"}})})}),Object(v.jsxs)("h3",{className:"main-card-header",children:[" ",e.CardTitle]}),Object(v.jsxs)("div",{style:{display:"flex",flexDirection:"row",marginLeft:"auto"},children:[e.filters.map((function(e){return Object(v.jsx)("div",{className:"main-card-header-item",children:e},e)})),null!==e.back_link?Object(v.jsx)(h.a,{className:"bg-dark border-0",onClick:function(){e.history.push(e.back_link)},children:Object(v.jsx)(K.a,{size:25})}):Object(v.jsx)(v.Fragment,{})]})]})}),Object(v.jsx)(u.a.Body,{className:"main-card-body",children:e.CardBody})]})})}var J=[{name:"Build a Survey",label:"surveyBuilder",text:"Get started straight away. Build a survey, collect test-data, and view your data.",icon:a(122).a,link:"https://survey.rhomis.cgiar.org/login/\r",external:!0},{name:"Module Management",label:"administrator",text:"Manage RHoMIS Modules",icon:K.b,link:"https://survey.rhomis.cgiar.org/login/\r",external:!0},{name:"Manage Projects",label:"projectManager",text:"Check up on your projects, download your data, and control user access.",icon:q.c,link:"/projects",external:!1},{name:"Help",label:"help",text:"See guidance for more advanced use case and how to contribute to our system",icon:q.a,link:"https://rhomis.github.io/rhomis-docs/source/user-guide/first-time-user.html#rhomis-portal",external:!0}];a(164);function Y(e){return X.apply(this,arguments)}function X(){return(X=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l()({method:"get",url:"https://auth.rhomis.cgiar.org/\rapi/user/",headers:{Authorization:t}});case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){var t=e.data.icon,a=Object(f.g)();return!1===e.data.external?Object(v.jsx)("div",{onClick:function(){a.push(e.data.link)},children:Object(v.jsxs)(u.a,{className:"sub-card portal-card border-0",children:[Object(v.jsx)("div",{className:"portal-card-header-container",children:Object(v.jsx)("h4",{className:"portal-card-header",children:e.data.name},"card-header-"+e.data.name)},"header-container-"+e.data.name),Object(v.jsx)("div",{className:"portal-icon-container",children:Object(v.jsx)(t,{size:100,color:"white"})},"icon-container-"+e.data.name)]},"card-"+e.data.name)}):!0===e.data.external&"surveyBuilder"===e.data.label?Object(v.jsx)("div",{children:Object(v.jsxs)("form",{method:"post",action:e.data.link,className:"inline",children:[Object(v.jsx)("input",{type:"hidden",name:"token",value:e.authToken}),Object(v.jsx)("input",{type:"hidden",name:"redirect_url",value:"/admin/xlsform/create"}),Object(v.jsx)("button",{type:"submit",style:{margin:0,padding:0,border:0,backgroundColor:"white"},children:Object(v.jsxs)(u.a,{className:"sub-card portal-card border-0",children:[Object(v.jsx)("div",{className:"portal-card-header-container",children:Object(v.jsx)("h4",{className:"portal-card-header",children:e.data.name},"card-header-"+e.data.name)},"header-container-"+e.data.name),Object(v.jsx)("div",{className:"portal-icon-container",children:Object(v.jsx)(t,{size:100,color:"white"})},"icon-container-"+e.data.name)]},"card-"+e.data.name)})]})}):"surveyBuilder"===e.data.name?Object(v.jsx)("div",{children:Object(v.jsxs)("form",{method:"post",action:e.data.link,className:"inline",children:[Object(v.jsx)("input",{type:"hidden",name:"token",value:e.authToken}),Object(v.jsx)("input",{type:"hidden",name:"redirect_url",value:"/admin/module"}),Object(v.jsx)("button",{type:"submit",style:{margin:0,padding:0,border:0,backgroundColor:"white"},children:Object(v.jsxs)(u.a,{className:"sub-card portal-card border-0",children:[Object(v.jsx)("div",{className:"portal-card-header-container",children:Object(v.jsx)("h4",{className:"portal-card-header",children:e.data.name},"card-header-"+e.data.name)},"header-container-"+e.data.name),Object(v.jsx)("div",{className:"portal-icon-container",children:Object(v.jsx)(t,{size:100,color:"white"})},"icon-container-"+e.data.name)]},"card-"+e.data.name)})]})}):!0===e.data.external&"surveyBuilder"!==e.data.label?Object(v.jsx)("div",{children:Object(v.jsx)("a",{style:{textDecoration:"none"},href:e.data.link,target:"_blank",children:Object(v.jsxs)(u.a,{className:"sub-card portal-card border-0",children:[Object(v.jsx)("div",{className:"portal-card-header-container",children:Object(v.jsx)("h4",{className:"portal-card-header",children:e.data.name})}),Object(v.jsx)("div",{className:"portal-icon-container",children:Object(v.jsx)(t,{size:100,color:"white"})})]})})}):void 0}function Z(e){var t=[];if(e.userData){if(!0===e.userData.basic){var a=e.data.filter((function(e){return"surveyBuilder"===e.label}));t.push.apply(t,Object(H.a)(a))}if(e.userData.dataCollector.length>0){var r=e.data.filter((function(e){return"dataCollector"===e.label}));t.push.apply(t,Object(H.a)(r))}if(e.userData.projectManager.length>0|e.userData.analyst.length>0){var n=e.data.filter((function(e){return"projectManager"===e.label}));t.push.apply(t,Object(H.a)(n))}if(!0===e.userData.administrator){var c=e.data.filter((function(e){return"administrator"===e.label}));t.push.apply(t,Object(H.a)(c))}if(e.userData.researcher.length>0|!0===e.userData.basic){var s=e.data.filter((function(e){return"globalData"===e.label}));t.push.apply(t,Object(H.a)(s))}if(!0===e.userData.basic){var o=e.data.filter((function(e){return"help"===e.label}));t.push.apply(t,Object(H.a)(o))}}return e.userData||t.push(e.data[0]),Object(v.jsx)(v.Fragment,{children:t.map((function(t){return Object(v.jsx)(Q,{data:t,authToken:e.authToken},t.label)}))})}function $(){var e=Object(r.useState)(null),t=Object(o.a)(e,2),a=t[0],n=t[1],c=Object(r.useState)(!1),s=Object(o.a)(c,2),i=(s[0],s[1]),l=Object(f.g)(),u=Object(r.useContext)(x),b=Object(o.a)(u,2),h=b[0],m=b[1];return Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){var t,a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=function(){return(a=Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A({setAuthToken:m});case 2:0==e.sent&&l.push("/logout");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)},t=function(){return a.apply(this,arguments)},t();case 3:case"end":return e.stop()}}),e)}))),[]),Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){var t;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y(h);case 2:t=e.sent,n(t),i(!0);case 5:case"end":return e.stop()}}),e)}))),[h]),Object(v.jsx)(W,{CardTitle:"Home",filters:[],history:null,back_link:null,doc_extension:"source/user-guide/first-time-user.html#rhomis-portal",CardBody:Z({data:J,userData:a,authToken:h})})}var ee=a(220),te=Object(r.createContext)(),ae=(a(105),a(93)),re=a.n(ae),ne=a(80);function ce(e){return se.apply(this,arguments)}function se(){return(se=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.setLoading(!0),g.Store.addNotification({title:"Creating Project",type:"default",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"],dismiss:{duration:2e3}}),e.prev=2,e.next=5,l()({method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/projects/create",data:{name:t.projectName,description:t.projectDescription},headers:{Authorization:t.authToken}});case 5:return 200===(a=e.sent).status&&g.Store.addNotification({title:"Success",message:"Project Created",type:"success",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"],dismiss:{duration:2e3}}),e.abrupt("return",a);case 10:e.prev=10,e.t0=e.catch(2),g.Store.addNotification({title:"Error",message:e.t0.response.data,type:"danger",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"],dismiss:{duration:2e3}});case 13:return t.setLoading(!1),e.abrupt("return");case 15:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function oe(e){return Object(v.jsxs)("div",{children:[Object(v.jsxs)(ee.a,{style:{width:"100%"},striped:!0,bordered:!0,hover:!0,children:[Object(v.jsx)("thead",{children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{children:"Project Name"},"table-head-item-1"),Object(v.jsx)("th",{children:"Description"},"table-head-item-2"),Object(v.jsx)("th",{children:"Created at"},"table-head-item-3")]},"table-row-1")},"table-header"),Object(v.jsx)("tbody",{children:Object(v.jsx)("tr",{children:Object(v.jsx)("td",{style:{textAlign:"center"},colSpan:3,children:"No projects found"})})})]}),Object(v.jsx)("div",{style:{display:"inline-grid",width:"100%"},children:Object(v.jsx)("div",{style:{marginLeft:"auto",marginRight:0},children:Object(v.jsx)(h.a,{type:"submit",className:"bg-dark border-0",onClick:Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I({authToken:e.authToken,setUserInfo:e.setAdminData});case 2:case"end":return t.stop()}}),t)}))),children:"New Project"})})})]})}function ie(e){var t=Object(f.g)(),a=Object(r.useState)(),n=Object(o.a)(a,2),c=n[0],s=n[1],i=Object(r.useState)(),l=Object(o.a)(i,2),u=l[0],m=l[1],p=Object(r.useState)(!1),O=Object(o.a)(p,2),x=(O[0],O[1]);return e.data&&e.data.projects?0===e.data.projects.length?Object(v.jsx)(oe,{authToken:e.authToken,setAdminData:e.setAdminData}):void 0!==e.data.projects?Object(v.jsxs)("div",{style:{width:"100%"},children:[Object(v.jsxs)(ee.a,{style:{width:"100%"},striped:!0,bordered:!0,hover:!0,children:[Object(v.jsx)("thead",{children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{children:"Project Name"},"table-head-item-1"),Object(v.jsx)("th",{children:"Description"},"table-head-item-2"),Object(v.jsx)("th",{children:"Created at"},"table-head-item-3"),Object(v.jsx)("th",{},"table-head-item-4")]},"table-row-1")},"table-header"),Object(v.jsx)("tbody",{children:e.data.projects.map((function(e,a){var r=new Date(e.createdAt).toDateString();return Object(v.jsxs)("tr",{children:[Object(v.jsx)("td",{style:{verticalAlign:"middle"},children:e.name},"table-row-"+a+"-item-1"),Object(v.jsx)("td",{style:{verticalAlign:"middle"},children:e.description},"table-row-"+a+"-item-2"),Object(v.jsx)("td",{style:{verticalAlign:"middle"},children:r},"table-row-"+a+"-item-3"),Object(v.jsx)("td",{style:{verticalAlign:"middle",textAlign:"center"},children:Object(v.jsx)(h.a,{className:"bg-dark text-white border-0",onClick:function(){t.push("/projects/"+e.name)},children:"Select"})},"table-row-"+a+"-item-4")]},"table-row-"+a)}))},"table-body")]}),Object(v.jsx)("div",{style:{display:"inline-grid",width:"100%"},children:Object(v.jsxs)("div",{style:{marginLeft:"auto",marginRight:0},children:[Object(v.jsxs)(b.a,{style:{marginBottom:"10px",marginRight:0},children:[Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:Object(v.jsx)("strong",{children:"New Project Name"})}),Object(v.jsx)(b.a.Control,{type:"text",placeholder:"New Project",onChange:function(e){s(e.target.value)}})]}),Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:Object(v.jsx)("strong",{children:"Project Description"})}),Object(v.jsx)(b.a.Control,{type:"textarea",placeholder:"A short description...",rows:3,onChange:function(e){m(e.target.value)}})]})]}),Object(v.jsx)("div",{style:{display:"inline-grid",width:"100%"},children:Object(v.jsx)("div",{style:{marginLeft:"auto",marginRight:0},children:Object(v.jsx)(h.a,{type:"submit",className:"bg-dark border-0",onClick:Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ce({authToken:e.authToken,projectName:c,projectDescription:u,setLoading:x});case 2:return x(!0),t.next=5,I({authToken:e.authToken,setUserInfo:e.setAdminData});case 5:x(!0);case 6:case"end":return t.stop()}}),t)}))),children:"Add Project"})})})]})})]}):void 0:Object(v.jsx)(oe,{authToken:e.authToken,setAdminData:e.setAdminData})}function le(e){var t=Object(f.g)(),a=Object(r.useContext)(x),n=Object(o.a)(a,2),c=n[0],s=n[1],i=Object(r.useContext)(te),l=Object(o.a)(i,2),u=l[0],b=l[1],h=Object(r.useState)(!1),m=Object(o.a)(h,2),p=(m[0],m[1]);return Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){var a,r;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=function(){return(r=Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A({setAuthToken:s});case 2:0==e.sent&&t.push("/logout");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)},a=function(){return r.apply(this,arguments)},a();case 3:case"end":return e.stop()}}),e)}))),[]),Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I({authToken:c,setUserInfo:b});case 2:case"end":return e.stop()}}),e)}))),[c]),Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(W,{CardTitle:"Select a Project",filters:[],history:t,back_link:"/",doc_extension:"source/user-guide/navigating-the-app.html#project-management",CardBody:ie({data:u,setProjectSelected:p,authToken:c,setAdminData:b})})})}var de=a(221),je=a(125);a(200);function ue(e){return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsxs)(ee.a,{striped:!0,bordered:!0,hover:!0,children:[Object(v.jsx)("thead",{children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{children:"Form Name"}),Object(v.jsx)("th",{children:"Status"}),Object(v.jsx)("th",{children:"Created At"})]})}),Object(v.jsx)("tbody",{children:Object(v.jsx)("tr",{children:Object(v.jsx)("td",{colSpan:3,children:"Forms Not Found"})})})]}),Object(v.jsx)(Oe,{authToken:e.authToken,projectSelected:e.projectSelected})]})}function be(e){var t="";return void 0===e.form||void 0===e.form.submissions?Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(m.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"})}):("draft"===e.draftOrLive&&(t=e.form.submissions.draft),"live"===e.draftOrLive&&(t=e.form.submissions.live),null===t&&(t="NA"),Object(v.jsx)(v.Fragment,{children:e.submissionsLoading?Object(v.jsx)(m.a,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}):t}))}function he(e){var t=!1,a=!1,r=!1;return void 0==e.form||void 0==e.form.submissions?Object(v.jsx)(v.Fragment,{}):(!0===e.form.live&&(t=!0),!0===e.form.draft&&(a=!0),!1===e.form.draft&!0===e.form.live&&(r=!0),Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)(de.a,{title:"Options",variant:"dark",menuVariant:"dark",className:"border-0",drop:"end",children:[t?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(je.a.Header,{children:"Live Forms"}),Object(v.jsx)(je.a.Item,{className:"dark text-white border-0",onClick:function(){e.history.push("/projects/"+e.projectSelected+"/forms/"+e.form.name+"/collect/live")},children:"Collect Data"}),Object(v.jsxs)("form",{method:"post",action:"https://survey.rhomis.cgiar.org/login/\r",className:"inline",children:[Object(v.jsx)("input",{type:"hidden",name:"token",value:e.authToken}),Object(v.jsx)("input",{type:"hidden",name:"redirect_url",value:"/xlsform/"+e.form.name+"/edit"}),r?Object(v.jsx)("button",{type:"submit",value:"submit",className:"form-button",children:"Create New Draft"}):Object(v.jsx)(v.Fragment,{})]}),e.form.submissions.live>0?Object(v.jsx)(je.a.Item,{className:"dark text-white border-0",onClick:function(){e.history.push("/projects/"+e.projectSelected+"/forms/"+e.form.name+"/data")},children:"Access Data"}):Object(v.jsx)(v.Fragment,{})]}):Object(v.jsx)(v.Fragment,{}),a?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(je.a.Header,{children:"Draft Forms"}),Object(v.jsx)(je.a.Item,{className:"dark text-white border-0",onClick:function(){e.history.push("/projects/"+e.projectSelected+"/forms/"+e.form.name+"/collect/draft")},children:"Test Survey"}),Object(v.jsxs)("form",{method:"post",action:"https://survey.rhomis.cgiar.org/login/\r",className:"inline",children:[Object(v.jsx)("input",{type:"hidden",name:"token",value:e.authToken}),Object(v.jsx)("input",{type:"hidden",name:"redirect_url",value:"/xlsform/"+e.form.name+"/edit"}),Object(v.jsx)("button",{type:"submit",value:"submit",className:"form-button",children:"Edit Draft"})]})]}):Object(v.jsx)(v.Fragment,{}),Object(v.jsx)(je.a.Header,{children:"Settings"}),Object(v.jsx)(je.a.Item,{className:"dark text-white border-0",onClick:function(){e.history.push("/projects/"+e.projectSelected+"/forms/"+e.form.name+"/users")},children:"Manage Users"})]})}))}function me(e){var t=Object(f.g)(),a=!1;if(!e.data)return Object(v.jsx)(ue,{authToken:e.authToken});if(!e.data.user)return Object(v.jsx)(ue,{authToken:e.authToken});if(!e.data.user.roles)return Object(v.jsx)(ue,{authToken:e.authToken});void 0!==e.data.user.roles.projectManager&&e.data.user.roles.projectManager.includes(e.projectSelected)&&(a=!0);var r=!1;void 0!==e.data.forms&&(e.data.forms.length>0&&(r=e.data.forms.filter((function(t){return t.project===e.projectSelected})).length>0));return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsxs)(ee.a,{striped:!0,bordered:!0,hover:!0,children:[Object(v.jsx)("thead",{children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{children:"Form Name"}),Object(v.jsx)("th",{children:"Draft Version"}),Object(v.jsx)("th",{children:"Draft Submissions"}),Object(v.jsx)("th",{children:"Live Version"}),Object(v.jsx)("th",{children:"Live Submissions"}),Object(v.jsx)("th",{})]})}),Object(v.jsx)("tbody",{children:r?e.data.forms.map((function(r){var n="NA";r.draft&&(n=r.draftVersion),void 0===r.draftVersion|""===r.draftVersion|null===r.draftVersion&&(n="NA");var c="NA";r.live&&(c=r.liveVersion),void 0===r.liveVersion|""===r.liveVersion|null===r.liveVersion&&(c="NA");!function(e){var t=new Date(e),a=""+(t.getMonth()+1),r=""+t.getDate(),n=t.getFullYear();a.length<2&&(a="0"+a),r.length<2&&(r="0"+r),[r,a,n].join("/")}(r.createdAt);if(r.project===e.projectSelected){var s=!1;return!1===a&&!1,r.draft&&!1,r.submissions>0&&(s=!0),Object(v.jsxs)("tr",{children:[Object(v.jsx)("td",{children:r.name}),Object(v.jsx)("td",{children:n}),Object(v.jsx)("td",{children:Object(v.jsx)(be,{submissionsLoading:e.submissionsLoading,form:r,draftOrLive:"draft"})}),Object(v.jsx)("td",{children:c}),Object(v.jsx)("td",{children:Object(v.jsx)(be,{submissionsLoading:e.submissionsLoading,form:r,draftOrLive:"live"})}),Object(v.jsx)("td",{style:{textAlign:"center"},children:Object(v.jsx)(he,{history:t,form:r,projectSelected:e.projectSelected,authToken:e.authToken,accessData:s})})]},r.name)}})):Object(v.jsx)(v.Fragment,{children:Object(v.jsx)("tr",{children:Object(v.jsx)("td",{style:{textAlign:"center"},colSpan:5,children:"No forms created yet"})})})})]}),Object(v.jsx)(Oe,{authToken:e.authToken,projectSelected:e.projectSelected})]})}function pe(e){var t=Object(r.useState)(""),a=Object(o.a)(t,2);a[0],a[1];return e.data&&e.data.user&&e.data.user.roles?(void 0!==e.data.user.roles.projectManager&&e.data.user.roles.projectManager.includes(e.projectSelected)&&!0,Object(v.jsx)("div",{style:{width:"100%"},children:Object(v.jsx)(me,{submissionsLoading:e.submissionsLoading,projectSelected:e.projectSelected,authToken:e.authToken,setAdminData:e.setAdminData,data:e.data,filters:e.filters,setFilters:e.setFilters,setFormSelected:e.setFormSelected})})):Object(v.jsx)(ue,{})}function Oe(e){return Object(v.jsxs)("form",{method:"post",action:"https://survey.rhomis.cgiar.org/login/\r",className:"inline",children:[Object(v.jsx)("input",{type:"hidden",name:"project_name",value:e.projectSelected}),Object(v.jsx)("input",{type:"hidden",name:"token",value:e.authToken}),Object(v.jsx)("input",{type:"hidden",name:"redirect_url",value:"/admin/xlsform/create"}),Object(v.jsx)("div",{style:{display:"inline-grid",width:"100%"},children:Object(v.jsx)("div",{style:{marginLeft:"auto",marginRight:0},children:Object(v.jsx)(h.a,{type:"submit",className:"bg-dark border-0",children:"New Form"})})})]})}var fe=function(){var e=Object(f.g)(),t=Object(f.h)().projectName,a=Object(r.useContext)(x),n=Object(o.a)(a,2),c=n[0],s=n[1],i=Object(r.useContext)(te),l=Object(o.a)(i,2),u=l[0],b=l[1],h=Object(r.useState)(!0),m=Object(o.a)(h,2),p=m[0],O=m[1],g=Object(r.useState)(),w=Object(o.a)(g,2),y=(w[0],w[1],Object(r.useState)(null)),k=Object(o.a)(y,2),S=k[0],N=k[1],_=Object(r.useState)([]),T=Object(o.a)(_,2),D=T[0],C=T[1];return Object(r.useEffect)((function(){function t(){return(t=Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,A({setAuthToken:s});case 2:0==t.sent&&e.push("/logout");case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){var a,r;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=function(){return(r=Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I({authToken:c,setUserInfo:b,getSubmissionCount:!0,projectName:t});case 2:O(!1);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)},a=function(){return r.apply(this,arguments)},a();case 3:case"end":return e.stop()}}),e)}))),[c]),Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(W,{CardTitle:"Form Overview",filters:[t],history:e,back_link:"/projects",doc_extension:"source/user-guide/navigating-the-app.html#form-overview",CardBody:pe({authToken:c,projectSelected:t,formSelected:S,setAdminData:b,data:u,setFormSelected:N,filters:D,setFilters:C,submissionsLoading:p})})})},xe=a(225),ge=a(224),ve=a(123),we=a(19);a(201);function ye(e){return ke.apply(this,arguments)}function ke(){return(ke=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l()({method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/meta-data",headers:{Authorization:t.authToken}});case 2:200===(a=e.sent).status&&(a.data.projects.length>0&&t.setShowProjectManagement(!0),!0===a.data.user.roles.administrator&&t.setShowAdmin(!0),a.data.user.roles.dataCollector.length>0&&t.setShowCollectData(!0)),400===a.status&&alert(a.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Se(e){var t=Object(r.useContext)(x),a=Object(o.a)(t,2),n=a[0],c=a[1],s=Object(r.useState)(!1),i=Object(o.a)(s,2),l=i[0],u=i[1],b=function(){return u(!1)},h=Object(r.useState)(!1),m=Object(o.a)(h,2),p=m[0],O=m[1],g=Object(r.useState)(!1),w=Object(o.a)(g,2),y=(w[0],w[1]),k=Object(r.useState)(!1),S=Object(o.a)(k,2),N=S[0],_=S[1];Object(f.g)();return Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye({authToken:n,setShowAdmin:O,setShowCollectData:y,setShowProjectManagement:_});case 2:case"end":return e.stop()}}),e)}))),[]),Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)(xe.a,{fixed:"top",bg:"dark",variant:"dark",expand:"false",children:[Object(v.jsx)(ge.a.Link,{className:"menu-button",as:we.b,to:"/home",children:Object(v.jsx)(K.c,{className:"menu-button-icon",size:30})}),Object(v.jsx)("h2",{style:{color:"white"},children:"RHoMIS"}),Object(v.jsx)(ge.a.Link,{className:"logout-button",as:we.b,to:"/logout",children:"Logout"}),Object(v.jsxs)(ve.a,{backdrop:"true",style:{"background-color":"#212529",width:"25%"},id:"offcanvasNavbar","aria-labelledby":"offcanvasNavbarLabel",placement:"start",show:l,onHide:b,children:[Object(v.jsx)(ve.a.Header,{closeVariant:"white",closeButton:!0,style:{color:"white","background-color":"#212529"},children:Object(v.jsx)(ve.a.Title,{id:"offcanvasNavbarLabel",children:Object(v.jsx)("h2",{style:{"padding-left":"20px"},children:"Dashboard"})})}),Object(v.jsxs)("div",{className:"side-bar-container",children:[Object(v.jsx)("div",{className:"side-bar-item",children:Object(v.jsx)(ge.a.Link,{className:"side-bar-link",as:we.b,onClick:function(){b()},to:"/",children:"Portal"})}),Object(v.jsx)("div",{className:"side-bar-item",children:Object(v.jsxs)("form",{style:{width:"100%"},method:"post",action:"https://survey.rhomis.cgiar.org/login/\r",className:"inline",children:[Object(v.jsx)("input",{type:"hidden",name:"token",value:n}),Object(v.jsx)("input",{type:"hidden",name:"redirect_url",value:"/admin/xlsform/create"}),Object(v.jsx)("input",{className:"form-link",type:"submit",value:"Build a Survey"})]})}),N?Object(v.jsx)("div",{className:"side-bar-item",children:Object(v.jsx)(ge.a.Link,{className:"side-bar-link",as:we.b,onClick:function(){b()},to:"/projects",children:"Manage Projects"})}):Object(v.jsx)(v.Fragment,{}),p?Object(v.jsx)("div",{className:"side-bar-item",children:Object(v.jsx)(ge.a.Link,{className:"side-bar-link",as:we.b,onClick:function(){b()},to:"/administration",children:"Administration"})}):Object(v.jsx)(v.Fragment,{}),Object(v.jsx)("div",{className:"side-bar-item",children:Object(v.jsx)(ge.a.Link,{className:"side-bar-link",as:we.b,to:"/login",onClick:function(){c(null),localStorage.clear()},children:"Logout"})})]})]})]})})}var Ne=a(223);a(204);function _e(e){return Te.apply(this,arguments)}function Te(){return(Te=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l()({method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/meta-data",headers:{Authorization:t.authToken}});case 2:200===(a=e.sent).status&&t.setProjectInformation(a.data),400===a.status&&alert(a.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function De(e,t,a){return Ce.apply(this,arguments)}function Ce(){return(Ce=Object(j.a)(Object(d.a)().mark((function e(t,a,r){var n;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l()({method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/projects/create",data:{name:a,description:r},headers:{Authorization:t}});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fe(e,t){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(j.a)(Object(d.a)().mark((function e(t,a){var r;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l()({method:"delete",url:"https://auth.rhomis.cgiar.org/\rapi/projects/delete",data:{name:a},headers:{Authorization:t}});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Le(e,t,a,r,n){return Ae.apply(this,arguments)}function Ae(){return(Ae=Object(j.a)(Object(d.a)().mark((function e(t,a,r,n,c){var s;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("https://auth.rhomis.cgiar.org/\rapi/forms/new?form_name="+r+"&project_name="+a+"&publish=false"),e.next=3,l()({method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/forms/new?form_name="+r+"&project_name="+a+"&publish=false",data:c,headers:{Authorization:t,"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}});case 3:return s=e.sent,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pe(e){return Ee.apply(this,arguments)}function Ee(){return(Ee=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l()({method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/forms/new-draft?form_name="+t.formName+"&project_name="+t.projectName+"&publish=false",data:t.formFile,headers:{Authorization:t.authToken,"Content-Type":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ue(e){return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsxs)(b.a,{children:[Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"Project Name"}),Object(v.jsx)(b.a.Control,{type:"text",onChange:function(t){e.setNewProjectName(t.target.value)}})]}),Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"Project Description"}),Object(v.jsx)(b.a.Control,{as:"textarea",rows:3,onChange:function(t){e.setNewProjectDescription(t.target.value)}})]})]}),Object(v.jsx)(h.a,{style:{textAlign:"right"},onClick:Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,De(e.authToken,e.newProjectName,e.newProjectDescription);case 2:return t.next=4,e.GetProjectInformation({authToken:e.authToken,setProjectInformation:e.setProjectInformation});case 4:case"end":return t.stop()}}),t)}))),children:"Add project"})]})}function Re(e){var t=Object(r.useState)([]),a=Object(o.a)(t,2),n=(a[0],a[1]),c=["No Projects"],s=!0;return void 0!==e.data&null!==e.data&&(void 0!==e.data.projects&&(c=e.data.projects.map((function(e){return e.name})),s=!1),0===e.data.projects.length&&(c=["No Projects"],s=!0)),Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)(b.a,{children:[Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"Select a Project"}),Object(v.jsxs)(b.a.Select,{defaultValue:"Select a Project",onChange:function(t){e.setSelectedDraftProject(t.target.value);var a=[];void 0!==e.data&null!==e.data&&(void 0!==e.data.forms&&(e.data.forms.map((function(e){e.project===t.target.value&!1===e.live&&a.push(e.name)})),n(a)),0===e.data.projects.length&&n([]))},disabled:s,"aria-label":"Default select example",children:[Object(v.jsx)("option",{disabled:!0,children:"Select a Project"}),c.map((function(e){return Object(v.jsx)("option",{children:e})}))]})]}),Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"Enter the name of the form"}),Object(v.jsx)(b.a.Control,{onChange:function(t){e.setNewFormName(t.target.value)}}),Object(v.jsx)(b.a.Text,{children:'This must match the "form_title" field in your xlsx form settings'})]}),Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"Enter the form version"}),Object(v.jsx)(b.a.Control,{onChange:function(t){e.setNewFormVersion(t.target.value)}}),Object(v.jsx)(b.a.Text,{children:'This must match the "version" field in your xlsx settings tab'})]}),Object(v.jsxs)(b.a.Group,{controlId:"file-select-blank-form",children:[Object(v.jsx)(b.a.Label,{children:"Select your file"}),Object(v.jsx)(b.a.Control,{type:"file",size:"lg",onChange:function(t){t.stopPropagation(),e.setSelectedFile(t.target.files[0])}})]}),Object(v.jsx)(h.a,{onClick:Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Le(e.authToken,e.selectedProject,e.newFormName,e.newFormVersion,e.selectedFile);case 2:return t.next=4,e.GetProjectInformation({authToken:e.authToken,setProjectInformation:e.setProjectInformation});case 4:case"end":return t.stop()}}),t)}))),children:"Submit"})]})})}function Be(e){var t=Object(r.useState)([]),a=Object(o.a)(t,2),n=a[0],c=a[1],s=["No Projects"],i=!0;return void 0!==e.data&null!==e.data&&(void 0!==e.data.projects&&(s=e.data.projects.map((function(e){return e.name})),i=!1),0===e.data.projects.length&&(s=["No Projects"],i=!0)),Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)(b.a,{children:[Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"Select the project containing the form you would like to update"}),Object(v.jsxs)(b.a.Select,{defaultValue:"Select a Project",onChange:function(t){e.setSelectedDraftProject(t.target.value);var a=[];void 0!==e.data&null!==e.data&&(void 0!==e.data.forms&&(e.data.forms.map((function(e){e.project===t.target.value&&a.push(e)})),c(a)),0===e.data.projects.length&&c([]))},disabled:i,"aria-label":"Default select example",children:[Object(v.jsx)("option",{disabled:!0,children:"Select a Project"}),s.map((function(e){return Object(v.jsx)("option",{children:e})}))]})]}),Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"Select the form you would like to update"}),Object(v.jsxs)(b.a.Select,{defaultValue:"Select a form",onChange:function(t){e.setNewDraftFormName(t.target.value)},"aria-label":"Default select example",children:[Object(v.jsx)("option",{disabled:!0,children:"Select a form"}),n.map((function(e){var t="";return!0===e.draft&&(t="draft: "+e.draftVersion),!0===e.live&&(t="live: "+e.liveVersion),!0===e.live&!0===e.draft&&(t="draft: "+e.draftVersion+", live: "+e.liveVersion),Object(v.jsx)("option",{value:e.name,children:e.name+" ("+t+")"})}))]})]}),Object(v.jsxs)(b.a.Group,{controlId:"file-select-update-form",children:[Object(v.jsx)(b.a.Label,{children:"Select your file"}),Object(v.jsx)(b.a.Control,{type:"file",size:"lg",onChange:function(t){e.setSelectedDraftFile(t.target.files[0])}})]}),Object(v.jsx)(h.a,{onClick:Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Pe({authToken:e.authToken,projectName:e.selectedDraftProject,formName:e.newDraftFormName,formVersion:e.newDraftFormVersion,formFile:e.selectedDraftFile});case 2:return t.next=4,e.GetProjectInformation({authToken:e.authToken,setProjectInformation:e.setProjectInformation});case 4:case"end":return t.stop()}}),t)}))),children:"Submit"})]})})}function Me(e){var t=Object(r.useState)([]),a=Object(o.a)(t,2),n=a[0],c=a[1],s=["No Projects"],i=!0;return void 0!==e.data&null!==e.data&&(void 0!==e.data.projects&&(s=e.data.projects.map((function(e){return e.name})),i=!1),0===e.data.projects.length&&(s=["No Projects"],i=!0)),Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)(b.a,{children:[Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"Select a project"}),Object(v.jsxs)(b.a.Select,{defaultValue:"Select a Project",onChange:function(t){e.setSelectedDraftProject(t.target.value);var a=[];void 0!==e.data&null!==e.data&&(void 0!==e.data.forms&&(e.data.forms.map((function(e){e.project===t.target.value&&a.push(e.name)})),c(a)),0===e.data.projects.length&&c([]))},disabled:i,"aria-label":"Default select example",children:[Object(v.jsx)("option",{disabled:!0,children:"Select a Project"}),s.map((function(e){return Object(v.jsx)("option",{children:e})}))]})]}),Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"Select the form you would like to finalize"}),Object(v.jsxs)(b.a.Select,{defaultValue:"Select a form",onChange:function(t){e.setNewDraftFormName(t.target.value)},"aria-label":"Default select example",children:[Object(v.jsx)("option",{disabled:!0,children:"Select a form"}),n.map((function(e){return Object(v.jsx)("option",{children:e})}))]})]}),Object(v.jsx)(h.a,{onClick:Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ze({authToken:e.authToken,project:e.selectedDraftProject,form:e.newDraftFormName});case 2:return t.next=4,e.GetProjectInformation({authToken:e.authToken,setProjectInformation:e.setProjectInformation});case 4:case"end":return t.stop()}}),t)}))),children:"Finalise"})]})})}function ze(e){return Ge.apply(this,arguments)}function Ge(){return(Ge=Object(j.a)(Object(d.a)().mark((function e(t){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l()({method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/forms/publish",headers:{Authorization:t.authToken},params:{form_name:t.form,project_name:t.project}});case 2:e.sent;case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ve(e){return e.data?void 0!==e.data.projects?Object(v.jsx)("div",{children:Object(v.jsxs)(ee.a,{children:[Object(v.jsx)("thead",{children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{children:"#"},"table-head-item-1"),Object(v.jsx)("th",{children:"Project Name"},"table-head-item-2"),Object(v.jsx)("th",{children:"Description"},"table-head-item-3")]},"table-row-1")},"table-header"),Object(v.jsx)("tbody",{children:e.data.projects.map((function(t,a){return Object(v.jsxs)("tr",{children:[Object(v.jsx)("td",{children:Object(v.jsx)(h.a,{variant:"danger",onClick:Object(j.a)(Object(d.a)().mark((function a(){return Object(d.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Fe(e.authToken,t.name);case 2:case"end":return a.stop()}}),a)}))),children:"Delete"})},"table-row-"+a+"-item-1"),Object(v.jsx)("td",{children:t.name},"table-row-"+a+"-item-2"),Object(v.jsx)("td",{children:t.description},"table-row-"+a+"-item-3")]},"table-row-"+a)}))},"table-body")]})}):void 0:Object(v.jsx)("div",{children:Object(v.jsxs)(ee.a,{children:[Object(v.jsx)("thead",{children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{children:"#"},"table-head-item-1"),Object(v.jsx)("th",{children:"Project Name"},"table-head-item-2"),Object(v.jsx)("th",{children:"Description"},"table-head-item-3")]},"table-row-1")},"table-header"),Object(v.jsx)("tbody",{children:Object(v.jsx)("tr",{children:Object(v.jsx)("td",{colSpan:3,children:"No projects found"})})})]})})}function He(e){return qe.apply(this,arguments)}function qe(){return(qe=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l()({url:"https://auth.rhomis.cgiar.org/\rapi/admin",method:"post",headers:{Authorization:t.authToken},data:{email:t.newAdmin}});case 3:return a=e.sent,e.abrupt("return",a.data);case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function Ke(){var e=Object(r.useContext)(x),t=Object(o.a)(e,2),a=t[0],n=t[1],c=Object(r.useState)(null),s=Object(o.a)(c,2),i=s[0],l=s[1],m=Object(r.useState)(null),p=Object(o.a)(m,2),O=p[0],g=p[1],w=Object(r.useState)(null),y=Object(o.a)(w,2),k=y[0],S=y[1],N=Object(r.useState)(null),D=Object(o.a)(N,2),C=D[0],F=D[1],I=Object(r.useState)(null),L=Object(o.a)(I,2),P=L[0],E=L[1],U=Object(r.useState)(null),R=Object(o.a)(U,2),B=R[0],M=R[1],z=Object(r.useState)(null),G=Object(o.a)(z,2),V=G[0],H=G[1],q=Object(r.useState)(null),K=Object(o.a)(q,2),W=K[0],J=K[1],Y=Object(r.useState)(null),X=Object(o.a)(Y,2),Q=X[0],Z=X[1],$=Object(r.useState)(null),ee=Object(o.a)($,2),te=ee[0],ae=ee[1],re=Object(r.useState)(null),ne=Object(o.a)(re,2),ce=ne[0],se=ne[1],oe=Object(f.g)(),ie=Object(r.useState)(null),le=Object(o.a)(ie,2),de=le[0],je=le[1];return Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A({setAuthToken:n});case 2:0==e.sent&&oe.push("/logout");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){var t,r;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=function(){return(r=Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_e({authToken:a,setProjectInformation:l});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)},t=function(){return r.apply(this,arguments)},t();case 3:case"end":return e.stop()}}),e)}))),[a]),Object(v.jsx)("div",{id:"project-management-container",className:"sub-page-container",children:Object(v.jsxs)(u.a,{className:"main-card border-0",children:[Object(v.jsx)(u.a.Header,{className:" bg-dark text-white",children:Object(v.jsx)("h3",{children:"Creating Forms/Projects"})}),Object(v.jsx)(u.a.Body,{children:Object(v.jsxs)(Ne.a,{defaultActiveKey:"0",children:[Object(v.jsxs)(Ne.a.Item,{eventKey:"0",children:[Object(v.jsx)(Ne.a.Header,{children:"Projects"}),Object(v.jsx)(Ne.a.Body,{children:Object(v.jsx)(Ve,{GetProjectInformation:_e,setProjectInformation:l,data:i,authToken:a})})]}),Object(v.jsxs)(Ne.a.Item,{eventKey:"1",children:[Object(v.jsx)(Ne.a.Header,{children:"Create a Project"}),Object(v.jsx)(Ne.a.Body,{children:Object(v.jsx)(Ue,{GetProjectInformation:_e,setProjectInformation:l,newProjectName:O,setNewProjectName:g,newProjectDescription:k,setNewProjectDescription:S,authToken:a})})]}),Object(v.jsxs)(Ne.a.Item,{eventKey:"2",children:[Object(v.jsx)(Ne.a.Header,{children:"Create a New Draft Form (Blank)"}),Object(v.jsx)(Ne.a.Body,{children:Object(v.jsx)(Re,{GetProjectInformation:_e,setProjectInformation:l,authToken:a,data:i,selectedFile:P,setSelectedFile:E,setNewFormName:M,newFormName:B,setNewFormVersion:H,newFormVersion:V,setSelectedProject:F,selectedProject:C})})]}),Object(v.jsxs)(Ne.a.Item,{eventKey:"3",children:[Object(v.jsx)(Ne.a.Header,{children:"Update Draft Form"}),Object(v.jsx)(Ne.a.Body,{children:Object(v.jsx)(Be,{GetProjectInformation:_e,setProjectInformation:l,authToken:a,data:i,selectedDraftFile:Q,setSelectedDraftFile:Z,setNewDraftFormName:ae,newDraftFormName:te,setNewDraftFormVersion:se,newDraftFormVersion:ce,setSelectedDraftProject:J,selectedDraftProject:W})})]}),Object(v.jsxs)(Ne.a.Item,{eventKey:"4",children:[Object(v.jsx)(Ne.a.Header,{children:"Finalize a Form"}),Object(v.jsx)(Ne.a.Body,{children:Object(v.jsx)(Me,{GetProjectInformation:_e,setProjectInformation:l,authToken:a,data:i,setSelectedDraftProject:J,selectedDraftProject:W,setNewDraftFormName:ae,newDraftFormName:te})})]}),Object(v.jsxs)(Ne.a.Item,{eventKey:"5",children:[Object(v.jsx)(Ne.a.Header,{children:"Add Administrator"}),Object(v.jsx)(Ne.a.Body,{children:Object(v.jsx)(b.a,{children:Object(v.jsx)(_.a,{children:Object(v.jsx)(T.a,{md:"4",children:Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"User Email"}),Object(v.jsx)(b.a.Control,{type:"email",onChange:function(e){je(e.target.value)}}),Object(v.jsx)(h.a,{className:"border-0 bg-dark",style:{marginTop:"10px"},onClick:Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:He({authToken:a,newAdmin:de});case 1:case"end":return e.stop()}}),e)}))),children:"Add User"})]})})})})})]})]})})]})})}function We(e){var t=Object(r.useContext)(x),a=Object(o.a)(t,2),n=(a[0],a[1]),c=Object(f.g)();return Object(r.useEffect)((function(){n(null),localStorage.clear(),c.push("/login")}),[]),Object(v.jsx)(v.Fragment,{})}function Je(e){var t=Object(r.useState)(""),a=Object(o.a)(t,2),n=a[0],c=a[1];return Object(r.useEffect)((function(){c("/xlsform/"+e.formSelected+"/edit")}),[]),Object(v.jsxs)("div",{style:{textAlign:"center"},children:[Object(v.jsx)("p",{children:Object(v.jsx)("a",{href:"https://docs.getodk.org/collect-install/",target:"_blank",children:"1. Install ODK"})}),Object(v.jsx)("p",{children:"2. Open the ODK app"}),Object(v.jsx)("p",{children:"3. Scan this QR code"}),e.formState.encoded_settings?Object(v.jsx)(re.a,{value:e.formState.encoded_settings}):Object(v.jsx)(m.a,{as:"span",animation:"border",size:"100px",role:"status","aria-hidden":"true"}),e.formState.draft?Object(v.jsx)("div",{style:{marginTop:"20px"},children:"*Your form is currently saved as a draft. Draft submissions you make will be removed once the form is finalised.*"}):Object(v.jsx)(v.Fragment,{}),Object(v.jsx)("div",{style:{marginTop:"20px"},children:Object(v.jsxs)("form",{method:"post",action:"https://survey.rhomis.cgiar.org/login/\r",className:"inline",children:[Object(v.jsx)("input",{type:"hidden",name:"token",value:e.authToken}),Object(v.jsx)("input",{type:"hidden",name:"redirect_url",value:n}),Object(v.jsx)(h.a,{variant:"dark",style:{verticalAlign:"center"},type:"submit",value:"submit",children:e.formState.draft?"Edit Draft":"Create New Draft"})]})})]})}function Ye(){var e=Object(f.h)().projectName,t=Object(f.h)().formName,a=Object(f.h)().draftOrLive,n=Object(r.useState)(!1),c=Object(o.a)(n,2),s=(c[0],c[1],Object(r.useState)(!0)),i=Object(o.a)(s,2),l=(i[0],i[1],Object(r.useContext)(x)),u=Object(o.a)(l,2),b=u[0],h=u[1],m=Object(r.useContext)(te),p=Object(o.a)(m,2),O=p[0],g=p[1],w=Object(f.g)(),y=Object(r.useState)({renderODKFormCode:!1,projectManagerOfForm:!1,dataAnalystOfForm:!1,odkConf:!1,encoded_settings:!1,draft:!1,live:!1,data:{forms:[],users:[],projects:[]}}),k=Object(o.a)(y,2),S=k[0],N=k[1];return Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A({setAuthToken:h});case 2:0==e.sent&&w.push("/logout");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){var t,a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=function(){return(a=Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I({authToken:b,setUserInfo:g});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)},t=function(){return a.apply(this,arguments)},t();case 3:case"end":return e.stop()}}),e)}))),[b]),Object(r.useEffect)((function(){var r=function(e){var t=function(e){return!!e.data&&!!e.data.forms&&1===e.data.forms.filter((function(t){return t.name===e.formSelected&t.project===e.projectSelected})).length}({data:e.data,formSelected:e.formSelected,projectSelected:e.projectSelected,draftOrLive:e.draftOrLive}),a=function(e){return!!e.data&&!!e.data.user&&!!e.data.user.roles&&!!e.data.user.roles.projectManager&&!!e.data.user.roles.projectManager.includes(e.projectSelected)}({data:e.data,projectSelected:e.projectSelected}),r=function(e){if(!e.data)return!1;if(!e.data.forms)return!1;var t=e.data.forms.filter((function(t){return t.name===e.formSelected&&t.project===e.projectSelected}));return 1===t.length&&(!0===t[0].draft&"draft"===e.draftOrLive?t[0].draftCollectionDetails:!!(!0===t[0].live&"live"===e.draftOrLive)&&t[0].collectionDetails)}({data:e.data,projectSelected:e.projectSelected,formSelected:e.formSelected,draftOrLive:e.draftOrLive}),n=function(e){if(!e.data)return!1;if(!e.data.forms)return!1;var t=e.data.forms.filter((function(t){return t.name===e.formSelected&&t.project===e.projectSelected}));if(1!==t.length)return!1;if("draft"===e.draftOrLive){var a=t[0].draftCollectionDetails;return Object(ne.deflateSync)(JSON.stringify(a)).toString("base64")}if("live"===e.draftOrLive){var r=t[0].collectionDetails;return Object(ne.deflateSync)(JSON.stringify(r)).toString("base64")}return!1}({data:e.data,projectSelected:e.projectSelected,formSelected:e.formSelected,draftOrLive:e.draftOrLive}),c=!1,s=!1;return"draft"==e.draftOrLive&&(c=!0),"live"==e.draftOrLive&&(s=!0),{renderODKFormCode:t,projectManagerOfForm:a,odkConf:r,encoded_settings:n,draft:c,live:s}}({data:O,formSelected:t,projectSelected:e,draftOrLive:a});N(r)}),[O]),Object(v.jsx)(W,{CardTitle:"Collect Data",filters:[e,t],history:w,back_link:"/projects/"+e,doc_extension:"source/user-guide/navigating-the-app.html#data-collection",CardBody:Je({formState:S,data:O,authToken:b,formSelected:t,projectSelected:e})})}var Xe=a(12),Qe=a(3),Ze=a(95);a(205);function $e(e){var t=Object(r.useState)(),a=Object(o.a)(t,2),n=a[0],c=a[1],s=Object(r.useState)(),i=Object(o.a)(s,2),l=i[0],b=i[1];return Object(r.useEffect)((function(){function t(){return(t=Object(j.a)(Object(d.a)().mark((function t(){var a;return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,nt({authToken:e.authToken,dataType:"rawData",projectID:e.projectSelected,formID:e.formSelected,unit:!1,data:!0});case 2:a=t.sent,c(a);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),Object(r.useEffect)((function(){if(n){var e=ht(n,l);b(e)}}),[n]),Object(v.jsxs)(u.a,{style:{marginTop:"30px",width:"100%"},children:[Object(v.jsx)(u.a.Header,{style:{backgroundColor:"#4B5320",color:"white"},children:"Raw Survey Responses"}),Object(v.jsxs)(u.a.Body,{children:["Download the raw data from your survey. If you have collected more responses since last time you visited, click refresh to fetch new responses. You can also recalculate indicators for all of these responses, by going through each of the steps below",Object(v.jsxs)("div",{style:{display:"inline-grid",width:"100%"},children:[Object(v.jsx)("div",{style:{marginLeft:"auto",marginRight:0},children:Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(h.a,{style:{margin:"2px"},className:"bg-dark border-0",onClick:Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setLoading(!0),t.next=3,lt({commandType:"raw-data",formSelected:e.formSelected,projectSelected:e.projectSelected,process_label:"Raw Data and Unit Extraction",data:e.userInfo,authToken:e.authToken});case 3:return t.next=5,U(Object(Xe.a)({setAuthToken:e.setAuthToken,authToken:e.authToken,setUserInfo:e.setUserInfo,projectName:e.projectSelected,formName:e.formSelected,setFormData:e.setFormData,setShowRawData:e.setShowRawData},"setUserInfo",e.setUserInfo));case 5:e.setLoading(!1);case 6:case"end":return t.stop()}}),t)}))),children:"Refresh"}),Object(v.jsx)("a",{download:e.projectSelected+"_"+e.formSelected+"_raw_data.csv",href:l,children:Object(v.jsx)(h.a,{style:{margin:"2px"},className:"bg-dark border-0",children:"Download"})}),Object(v.jsx)(h.a,{style:{margin:"2px"},className:"bg-dark border-0",onClick:Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setLoading(!0),t.next=3,lt({commandType:"units",formSelected:e.formSelected,projectSelected:e.projectSelected,process_label:"Extracting Units",data:e.userInfo,authToken:e.authToken});case 3:return t.next=5,U(Object(Xe.a)({setAuthToken:e.setAuthToken,authToken:e.authToken,setUserInfo:e.setUserInfo,projectName:e.projectSelected,formName:e.formSelected,setFormData:e.setFormData,setShowRawData:e.setShowRawData},"setUserInfo",e.setUserInfo));case 5:e.setLoading(!1);case 6:case"end":return t.stop()}}),t)}))),children:"Extract Units"})]})}),Object(v.jsxs)("div",{style:{marginLeft:"auto",marginRight:0},children:["Last Updated: ",e.formData.time_updated.rawDataExtracted]})]})]})]})}function et(e){var t="",a="black",r=!1;return!0===e.showPrices&&(t="#4B5320",a="white",r=!0),Object(v.jsxs)(u.a,{style:{marginTop:"30px",width:"100%"},children:[Object(v.jsx)(u.a.Header,{style:{backgroundColor:t,color:a},children:r?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(Ze.a,{})," Units and Data Cleaning (Completed)"]}):"Units and Data Cleaning"}),Object(v.jsxs)(u.a.Body,{children:["Here you can provide conversion factors for any values which were recorded in the survey The units you enter here will be used to calculate key indicators, such as crop yield, amounts of livestock products produced, and amounts of inputs used. You can also correct any mispelt livestock or crop names",Object(v.jsx)("br",{}),Object(v.jsx)("br",{}),'Go through each table individually and convert units where you can. When you have converted all the units in one table click "Submit". When you have converted all of the units tick the confirmation box below and you will proceed to the next step in the calculations.',Object(v.jsx)("br",{}),Object(v.jsx)("br",{}),"For more information on converting units, click"," ",Object(v.jsx)("a",{href:"https://rhomis.github.io/rhomis-docs/"+e.doc_extension,target:"_blank",children:"here"}),Object(v.jsx)("br",{}),Object(v.jsx)("br",{}),Object(v.jsx)(it,Object(Qe.a)(Object(Qe.a)({},e),{},{formType:"units",formLabel:"Select the type of unit",checkBoxLabel:"I confirm that I have verified and submitted all units, proceed to (re)calculate product prices",submissionLabel:"Calculate Prices",commandType:"prices",processLabel:"Price Calculations",updatedTime:e.formData.time_updated.unitsExtracted}))]})]})}function tt(e){var t="",a="black",r=!1;return!0===e.showOutputs&&(t="#4B5320",a="white",r=!0),Object(v.jsxs)(u.a,{style:{marginTop:"30px",width:"100%"},children:[Object(v.jsx)(u.a.Header,{style:{backgroundColor:t,color:a},children:r?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(Ze.a,{})," Prices and Calorie Conversion Verification (Completed)"," "]}):"Prices and Calorie Conversion Verification"}),Object(v.jsxs)(u.a.Body,{children:["In the previous step you tidied crop and livestock names. You also provided numeric conversion factors for units. These were used these to identify which crops and livestock to calculate indicators for.",Object(v.jsx)("br",{}),Object(v.jsx)("br",{}),"We have estimated prices and calorie conversions for crops and livestock in this survey. Here you can verify them, these estimates will be used when calculating final indicators.",Object(v.jsx)("br",{}),Object(v.jsx)("br",{}),'Again, go through each table individually and convert units where you can. When you have converted all values in one table click "Submit". When you have converted all of tables, tick the confirmation box below and you will proceed to calculate final indicators.',Object(v.jsx)("br",{}),Object(v.jsx)("br",{}),"For more information on converting prices and calories, click"," ",Object(v.jsx)("a",{href:"https://rhomis.github.io/rhomis-docs/"+e.doc_extension,target:"_blank",children:"here"}),Object(v.jsx)("br",{}),Object(v.jsx)("br",{}),Object(v.jsx)(it,Object(Qe.a)(Object(Qe.a)({},e),{},{formType:"prices",formLabel:"Select the price/calorie conversion",checkBoxLabel:"I confirm that I have verified and submitted all price and calorie conversions, proceed to (re)calculate RHoMIS indicators",submissionLabel:"Calculate Indicators",commandType:"indicators",processLabel:"Indicator Calculations",updatedTime:e.formData.time_updated.pricesCalculated}))]})]})}function at(e){var t=Object(r.useState)(null),a=Object(o.a)(t,2),n=(a[0],a[1],Object(r.useState)(null)),c=Object(o.a)(n,2),s=(c[0],c[1],Object(r.useState)("")),i=Object(o.a)(s,2),l=i[0],b=i[1],p=Object(r.useState)(!0),O=Object(o.a)(p,2),f=O[0],x=O[1];return Object(r.useEffect)((function(){function t(){return(t=Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,jt({projectID:e.projectSelected,formID:e.formSelected,setButtonLoading:x,authToken:e.authToken,dataDownloadLink:l,setDataDownloadLink:b});case 2:x(!1);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[]),Object(v.jsxs)(u.a,{style:{marginTop:"30px",width:"100%"},children:[Object(v.jsx)(u.a.Header,{style:{backgroundColor:"#4B5320",color:"white"},children:"Final Outputs"}),Object(v.jsxs)(u.a.Body,{children:["You can now access all results for this survey by clicking the button below.",Object(v.jsx)("br",{}),Object(v.jsx)("br",{}),"The results in this bulk download include:",Object(v.jsxs)("ul",{children:[Object(v.jsx)("li",{children:Object(v.jsx)("strong",{children:"Documentation"})}),Object(v.jsx)("li",{children:Object(v.jsx)("strong",{children:"The most recent survey draft"})}),Object(v.jsx)("li",{children:Object(v.jsx)("strong",{children:"Indicator Data"})}),Object(v.jsx)("li",{children:Object(v.jsx)("strong",{children:"Processed Data"})}),Object(v.jsx)("li",{children:Object(v.jsx)("strong",{children:"Reformatted Outputs"})})]}),Object(v.jsx)("br",{}),"More details about the outputs will be included in the bulk-download folder, in a ",Object(v.jsx)("strong",{children:"README.txt "}),"file.",Object(v.jsxs)("div",{style:{display:"inline-grid",width:"100%"},children:[Object(v.jsx)("div",{style:{marginLeft:"auto",marginRight:0},children:f?Object(v.jsx)(m.a,{}):Object(v.jsx)("a",{download:e.projectSelected+"_"+e.formSelected+".zip",href:l,children:Object(v.jsx)(h.a,{style:{margin:"2px"},className:"bg-dark border-0",children:"Download Results"})})}),Object(v.jsxs)("div",{style:{marginLeft:"auto",marginRight:0},children:["Last Updated: ",e.formData.time_updated.finalIndicators]})]})]})]})}function rt(e){return Object(v.jsx)("div",{className:"table-div",children:Object(v.jsxs)(ee.a,{className:"units-table",children:[Object(v.jsx)("thead",{children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{children:"Survey Value"}),Object(v.jsx)("th",{children:"Conversion"})]},"row_1")}),Object(v.jsx)("tbody",{children:e.unitsData.map((function(t){return Object(v.jsxs)("tr",{children:[Object(v.jsx)("td",{style:{verticalAlign:"middle"},children:t.survey_value},"unit-row-"+t.survey_value+"-survey-value-"+t.id_rhomis_dataset),Object(v.jsxs)("td",{style:{verticalAlign:"middle"},children:[Object(v.jsx)("form",{children:Object(v.jsx)("input",{className:"form-control",type:"text",defaultValue:t.conversion,onChange:function(a){!function(e){console.log("UPDATE UNIT DATA"),console.log(e);var t=e.unitsData,a=t.findIndex((function(t){if(t.unit_type===e.unit.unit_type&&t.survey_value===e.unit.survey_value&&t.id_rhomis_dataset===e.unit.id_rhomis_dataset)return!0}));t[a].conversion=e.update,console.log(t),e.setUnitsData(t)}(Object(Qe.a)(Object(Qe.a)({},e),{},{update:a.target.value,unit:t}))}})})," "]},"unit-row-"+t.survey_value+"-conversion-"+t.id_rhomis_dataset)]},"unit-row-"+t.survey_value+t.id_rhomis_dataset)}))})]})})}function nt(e){return ct.apply(this,arguments)}function ct(){return(ct=Object(j.a)(Object(d.a)().mark((function e(t){var a,r;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l()({method:"post",url:"https://api.rhomis.cgiar.org/\rapi/data",data:{dataType:t.dataType,projectID:t.projectID,formID:t.formID,unit:t.unit,data:t.data},headers:{Authorization:t.authToken}});case 2:if(a=e.sent,null!==(r=a.data)){e.next=8;break}return e.abrupt("return",null);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function st(e){return ot.apply(this,arguments)}function ot(){return(ot=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l()({method:"post",url:"https://api.rhomis.cgiar.org/\rapi/conversions",headers:{Authorization:t.authToken},data:{projectSelected:t.projectSelected,formSelected:t.formSelected,unitType:t.unitsSelect,unitsData:t.unitsData}});case 3:return 200===(a=e.sent).status&&g.Store.addNotification({title:"Success",message:t.process_label+" Completed",type:"success",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"],dismiss:{duration:2e3}}),e.abrupt("return",a);case 8:e.prev=8,e.t0=e.catch(0),g.Store.addNotification({title:"Error",message:e.t0.response.data,type:"danger",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"],dismiss:{duration:2e3}});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function it(e){var t=Object(r.useState)(null),a=Object(o.a)(t,2),n=a[0],c=a[1],s=Object(r.useState)(),i=Object(o.a)(s,2),l=i[0],u=i[1],m=Object(r.useState)([{survey_value:"",conversion:""}]),p=Object(o.a)(m,2),O=p[0],f=p[1],x=Object(r.useState)(!1),g=Object(o.a)(x,2),w=g[0],y=g[1],k=["mean_crop_price_lcu_per_kg","mean_livestock_price_per_animal","mean_meat_price_per_kg","mean_milk_price_per_litre","mean_eggs_price_per_kg","mean_bees_honey_price_per_kg","crop_calories","milk_calories","eggs_calories","honey_calories","meat_calories","staple_crop","livestock_weight_kg","livestock_count_to_tlu"];return Object(r.useEffect)((function(){}),[O]),Object(v.jsxs)(v.Fragment,{children:[Object(v.jsxs)(b.a,{children:[Object(v.jsx)(b.a.Label,{children:e.formLabel}),Object(v.jsxs)(b.a.Select,{defaultValue:"Select",onChange:function(){var t=Object(j.a)(Object(d.a)().mark((function t(a){var r,s;return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,st(Object(Qe.a)(Object(Qe.a)({},e),{},{unitsData:O,unitsSelect:n,process_label:"Conversion Submission"}));case 2:return c(a.target.value),t.next=5,nt({authToken:e.authToken,dataType:a.target.value,projectID:e.projectSelected,formID:e.formSelected,unit:!0,data:!1});case 5:r=t.sent,s=ht(r,l),u(s),f(r);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),children:[Object(v.jsx)("option",{disabled:!0,children:"Select"},"default-select"),e.formData.units.map((function(t){return"units"===e.formType&&!1===k.some((function(e){return e==t}))||"prices"===e.formType&&!0===k.some((function(e){return e==t}))?Object(v.jsx)("option",{children:t},"unit-option-"+t):void 0}))]})]}),Object(v.jsx)("br",{}),n?Object(v.jsx)(rt,{unitsData:O,setUnitsData:f}):Object(v.jsx)(v.Fragment,{}),Object(v.jsx)("br",{}),Object(v.jsx)(b.a,{children:Object(v.jsx)(b.a.Group,{className:"mb-3",controlId:"formBasicCheckbox",children:Object(v.jsx)(b.a.Check,{type:"checkbox",label:e.checkBoxLabel,onChange:function(){y(!w)}})})}),Object(v.jsxs)("div",{style:{display:"inline-grid",width:"100%"},children:[Object(v.jsx)("div",{style:{marginLeft:"auto",marginRight:0},children:w?Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(h.a,{className:"bg-dark border-0",onClick:Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setLoading(!0),t.next=3,lt({commandType:e.commandType,formSelected:e.formSelected,projectSelected:e.projectSelected,process_label:e.processLabel,data:e.userInfo,authToken:e.authToken});case 3:return t.next=5,U(Object(Xe.a)({setAuthToken:e.setAuthToken,authToken:e.authToken,setUserInfo:e.setUserInfo,projectName:e.projectSelected,formName:e.formSelected,setFormData:e.setFormData,setShowRawData:e.setShowRawData},"setUserInfo",e.setUserInfo));case 5:e.setLoading(!1);case 6:case"end":return t.stop()}}),t)}))),children:e.submissionLabel})}):Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)("a",{download:e.projectSelected+"_"+e.formSelected+"_"+n+".csv",href:l,children:Object(v.jsx)(h.a,{style:{margin:"2px"},className:"bg-dark border-0",children:"Download"})}),Object(v.jsx)(h.a,{className:"bg-dark border-0",onClick:Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,st(Object(Qe.a)(Object(Qe.a)({},e),{},{unitsData:O,unitsSelect:n,process_label:"Conversion Submission"}));case 2:case"end":return t.stop()}}),t)}))),children:"Submit"})]})}),Object(v.jsxs)("div",{style:{marginLeft:"auto",marginRight:0},children:["Last Updated: ",e.updatedTime]})]})]})}function lt(e){return dt.apply(this,arguments)}function dt(){return(dt=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data.forms.filter((function(e){return e.name===t.formSelected&&e.project===t.projectSelected}))[0],g.Store.addNotification({id:"notification-start",title:t.process_label+" Started",message:"Please wait",type:"default",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"]}),e.prev=2,e.next=5,l()({method:"post",url:"https://api.rhomis.cgiar.org/\rapi/process-data",headers:{Authorization:t.authToken},data:{commandType:t.commandType,projectName:t.projectSelected,formName:t.formSelected,formVersion:a.liveVersion,draft:a.draft}});case 5:return 200===e.sent.status&&(g.Store.addNotification({title:"Success",message:t.process_label+" Completed",type:"default",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"],dismiss:{duration:2e3}}),g.Store.removeNotification("notification-start")),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(2),g.Store.addNotification({title:"Error",message:e.t0.response.data,type:"danger",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"]}),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function jt(e){return ut.apply(this,arguments)}function ut(){return(ut=Object(j.a)(Object(d.a)().mark((function e(t){var a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l()({method:"post",responseType:"arraybuffer",url:"https://api.rhomis.cgiar.org/\rapi/data/all-data",data:{projectID:t.projectID,formID:t.formID},headers:{Authorization:t.authToken}});case 2:return a=e.sent,t.setDataDownloadLink(bt(a.data,t.dataDownloadLink)),e.abrupt("return");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bt(e,t){var a=new Blob([e],{type:"application/zip"});return""!==t&&window.URL.revokeObjectURL(t),window.URL.createObjectURL(a)}function ht(e,t){var a=function(e){if(null!==e&&void 0!==e.length){for(var t=[],a=e,r=[],n=0;n<a.length;n++)for(var c=Object.keys(a[n]),s=0;s<c.length;s++){var o=c[s];if(!r.some((function(e){return e===o}))&&(0===n&&r.splice(s,0,o),n>0))if(void 0!==!c[s-1]){var i=r.indexOf(c[s-1]);r.splice(i+1,0,o)}else r.splice(s+1,0,o)}t.push(r.join(", "));var l=a.map((function(e){return r.map((function(t){return null!==e[t]?e[t]:""})).join(", ")}));return(t=t.concat(l)).join("\n")}}(e),r=new Blob([a],{type:"text/plain"});return""!==t&&window.URL.revokeObjectURL(t),window.URL.createObjectURL(r)}function mt(e){return pt.apply(this,arguments)}function pt(){return(pt=Object(j.a)(Object(d.a)().mark((function e(t){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1==t.formData.rawDataExtracted&&t.setShowRawData(!0),0!=t.formData.rawDataExtracted){e.next=11;break}return t.setLoading(!0),e.next=5,lt({commandType:"raw-data",formSelected:t.formSelected,projectSelected:t.projectSelected,process_label:"Extraction of Raw Data",data:t.data,authToken:t.authToken,setLoading:t.setLoading});case 5:if(!0!==e.sent){e.next=11;break}return e.next=9,U({setAuthToken:t.setAuthToken,authToken:t.authToken,setUserInfo:t.setUserInfo,projectName:t.projectSelected,formName:t.formSelected,setFormData:t.setFormData,setShowRawData:t.setShowRawData,userInfo:t.setUserInfo});case 9:t.setLoading(!1),g.Store.removeNotification("unit_extraction");case 11:1==t.formData.unitsExtracted&&t.setShowUnits(!0),1==t.formData.pricesCalculated&&t.setShowPrices(!0),t.formData.pricesCalculated,1==t.formData.finalIndicators&&t.setShowOutputs(!0),t.formData.finalIndicators;case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ot(){var e,t=Object(f.h)().projectName,a=Object(f.h)().formName,n=Object(r.useContext)(x),c=Object(o.a)(n,2),s=c[0],i=c[1],l=Object(r.useContext)(te),u=Object(o.a)(l,2),b=u[0],h=u[1],p=Object(f.g)(),O=Object(r.useState)({}),g=Object(o.a)(O,2),w=g[0],y=g[1],k=Object(r.useState)(!0),S=Object(o.a)(k,2),N=S[0],_=S[1],T=Object(r.useState)(!1),D=Object(o.a)(T,2),C=D[0],F=D[1],I=Object(r.useState)(!1),L=Object(o.a)(I,2),P=L[0],E=L[1],R=Object(r.useState)(!1),B=Object(o.a)(R,2),M=B[0],z=B[1],G=Object(r.useState)(!1),V=Object(o.a)(G,2),H=V[0],q=V[1];return Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A({setAuthToken:i});case 2:0==e.sent&&p.push("/logout");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){var r,n;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=function(){return(n=Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(Object(Xe.a)({setAuthToken:i,authToken:s,setUserInfo:h,projectName:t,formName:a,setFormData:y,setShowRawData:q},"setUserInfo",h));case 2:_(!1);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)},r=function(){return n.apply(this,arguments)},r();case 3:case"end":return e.stop()}}),e)}))),[s]),Object(r.useEffect)((function(){function e(){return(e=Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mt({setAuthToken:i,authToken:s,setUserInfo:h,setFormData:y,formData:w,data:b,projectSelected:t,formSelected:a,setShowUnits:F,setShowPrices:E,setShowOutputs:z,setLoading:_,setShowRawData:q});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[w]),Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(W,{CardTitle:"Data",filters:[t,a],history:p,back_link:"/projects/"+t,doc_extension:"source/user-guide/processing-data.html#managing-data",CardBody:N?Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(m.a,{as:"span",animation:"border",style:{marginTop:"4em",width:"4rem",height:"4rem"},role:"status","aria-hidden":"true"})}):(e={authToken:s,formData:w,projectSelected:t,formSelected:a,showUnits:C,showRawData:H,userInfo:b,showPrices:P,showOutputs:M,setAuthToken:i,setFormData:y,setLoading:_,setUserInfo:h,doc_extension:"source/user-guide/processing-data.html#managing-data"},Object(v.jsxs)(v.Fragment,{children:[e.showRawData?Object(v.jsx)($e,Object(Qe.a)({},e)):Object(v.jsx)(v.Fragment,{}),e.showUnits?Object(v.jsx)(et,Object(Qe.a)({},e)):Object(v.jsx)(v.Fragment,{}),e.showPrices?Object(v.jsx)(tt,Object(Qe.a)({},e)):Object(v.jsx)(v.Fragment,{}),e.showOutputs?Object(v.jsx)(at,Object(Qe.a)({},e)):Object(v.jsx)(v.Fragment,{})]}))})})}function ft(e){return!!e.data&&(!!e.data.user&&(!!e.data.user.roles&&(!!e.data.user.roles.projectManager&&!!e.data.user.roles.projectManager.includes(e.projectSelected))))}function xt(e){return"projectManager"===e.userType?{method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/user/project-manager",headers:{Authorization:e.authToken},data:{projectName:e.projectName,email:e.email}}:"dataCollector"===e.userType?{method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/user/data-collector",headers:{Authorization:e.authToken},data:{formName:e.formName,email:e.email}}:"analyst"===e.userType?{method:"post",url:"https://auth.rhomis.cgiar.org/\rapi/user/analyst",headers:{Authorization:e.authToken},data:{formName:e.formName,email:e.email}}:void 0}function gt(e){return vt.apply(this,arguments)}function vt(){return(vt=Object(j.a)(Object(d.a)().mark((function e(t){var a,r;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=xt(t),e.prev=1,e.next=4,l()(a);case 4:return 200===(r=e.sent).status&&g.Store.addNotification({title:"Success",message:"User Added",type:"success",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"],dismiss:{duration:2e3}}),e.abrupt("return",r);case 9:return e.prev=9,e.t0=e.catch(1),g.Store.addNotification({title:"Error",message:e.t0.response.data,type:"danger",insert:"top",container:"top-right",animationIn:["animate__animated","animate__fadeIn"],animationOut:["animate__animated","animate__fadeOut"],dismiss:{duration:2e3}}),e.abrupt("return",e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function wt(e){var t=Object(r.useState)(),a=Object(o.a)(t,2),n=(a[0],a[1],Object(r.useState)()),c=Object(o.a)(n,2),s=c[0],i=c[1],l=Object(r.useState)(""),m=Object(o.a)(l,2),p=m[0],O=m[1],f=Object(r.useState)(""),x=Object(o.a)(f,2),g=x[0],w=x[1];return Object(v.jsx)(v.Fragment,{children:e.projectManagerOfForm?Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)(u.a.Body,{children:[Object(v.jsxs)(u.a,{children:[Object(v.jsx)(u.a.Header,{as:"h5",children:"Add Project Manager"}),Object(v.jsx)(u.a.Body,{children:Object(v.jsxs)(b.a,{children:[Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"User email"}),Object(v.jsx)(b.a.Control,{onChange:function(e){i(e.target.value)}})]}),Object(v.jsx)(h.a,{className:"bg-dark text-white border-0 float-right",style:{marginTop:"10px"},onClick:Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,gt({authToken:e.authToken,email:s,projectName:e.projectSelected,formName:null,userType:"projectManager"});case 2:t.sent;case 3:case"end":return t.stop()}}),t)}))),children:"Add Project Manager"})]})})]}),Object(v.jsx)("br",{}),Object(v.jsxs)(u.a,{children:[Object(v.jsx)(u.a.Header,{as:"h5",children:"Add Form Level User"}),Object(v.jsx)(u.a.Body,{children:Object(v.jsxs)(b.a,{children:[Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"User email"}),Object(v.jsx)(b.a.Control,{onChange:function(e){w(e.target.value)}})]}),Object(v.jsxs)(b.a.Group,{children:[Object(v.jsx)(b.a.Label,{children:"User Role"}),Object(v.jsxs)(b.a.Select,{"aria-label":"Default select example",defaultValue:"Open this select menu",onChange:function(e){O(e.target.value)},children:[Object(v.jsx)("option",{disabled:!0,children:"Open this select menu"}),Object(v.jsx)("option",{value:"dataCollector",children:"Data Collector: Can access training materials and configure enumerator devices"}),Object(v.jsx)("option",{value:"analyst",children:"Data Analyst: Can download processed data"})]})]}),Object(v.jsx)(h.a,{className:"bg-dark text-white border-0 float-right",style:{marginTop:"10px"},onClick:Object(j.a)(Object(d.a)().mark((function t(){return Object(d.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,gt({authToken:e.authToken,email:g,formName:e.formSelected,userType:p});case 2:t.sent;case 3:case"end":return t.stop()}}),t)}))),children:"Add User"})]})})]})]})}):Object(v.jsx)(v.Fragment,{})})}function yt(){var e=Object(r.useState)(!1),t=Object(o.a)(e,2),a=t[0],n=t[1],c=Object(f.h)().projectName,s=Object(f.h)().formName,i=Object(r.useContext)(te),l=Object(o.a)(i,2),u=l[0],b=(l[1],Object(r.useContext)(x)),h=Object(o.a)(b,2),m=h[0],p=h[1],O=Object(f.g)();return Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){var t,a;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=function(){return(a=Object(j.a)(Object(d.a)().mark((function e(){return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A({setAuthToken:p});case 2:0==e.sent&&O.push("/logout");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)},t=function(){return a.apply(this,arguments)},t();case 3:case"end":return e.stop()}}),e)}))),[]),Object(r.useEffect)(Object(j.a)(Object(d.a)().mark((function e(){var t;return Object(d.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ft({data:u,projectSelected:c}),n(t);case 2:case"end":return e.stop()}}),e)}))),[m]),Object(r.useEffect)((function(){var e=ft({data:u,projectSelected:c});n(e)}),[u]),Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(W,{CardTitle:"User Management",filters:[c,s],history:O,back_link:"/projects/"+c,doc_extension:"source/user-guide/navigating-the-app.html#user-management",CardBody:wt({projectSelected:c,formSelected:s,projectManagerOfForm:a,authToken:m})})})}function kt(){var e=Object(r.useContext)(x),t=Object(o.a)(e,2),a=t[0],n=t[1],c=Object(r.useContext)(te),s=Object(o.a)(c,2),i=(s[0],s[1],Object(r.useState)(!1)),l=Object(o.a)(i,2),d=(l[0],l[1],Object(r.useState)(null)),j=Object(o.a)(d,2),u=j[0],b=j[1];Object(f.g)();return Object(r.useEffect)((function(){A({setAuthToken:n})}),[]),Object(r.useEffect)((function(){b(null!==a)}),[a]),Object(v.jsxs)(we.a,{children:[u?Object(v.jsx)(Se,{}):Object(v.jsx)(v.Fragment,{}),Object(v.jsxs)(f.d,{children:[Object(v.jsx)(f.b,{exact:!0,path:"/",children:Object(v.jsx)(f.a,{from:"/",to:"/home"})}),Object(v.jsx)(f.b,{path:"/home",component:$}),Object(v.jsx)(f.b,{path:"/projects/:projectName/forms/:formName/collect/:draftOrLive",component:Ye}),Object(v.jsx)(f.b,{path:"/projects/:projectName/forms/:formName/users",component:yt}),Object(v.jsx)(f.b,{path:"/projects/:projectName/forms/:formName/data",component:Ot}),Object(v.jsx)(f.b,{path:"/projects/:projectName",component:fe}),Object(v.jsx)(f.b,{path:"/projects",children:Object(v.jsx)(le,{})}),Object(v.jsx)(f.b,{path:"/administration",component:Ke}),Object(v.jsx)(f.b,{path:"/logout",component:We}),Object(v.jsx)(f.b,{path:"/login",children:Object(v.jsx)(N,{})}),Object(v.jsx)(f.b,{path:"/register",children:Object(v.jsx)(V,{})}),Object(v.jsx)(f.a,{from:"*",to:"/home"})]})]})}a(206),a(207);function St(){return Object(v.jsx)("div",{className:"child-no-mobile-container",children:Object(v.jsxs)(u.a,{className:"card-style border-0 no-mobile-card",children:[Object(v.jsx)(u.a.Header,{className:"bg-dark text-white",children:"Screen Width To Small"}),Object(v.jsxs)(u.a.Body,{children:[Object(v.jsx)("div",{className:"icon-container",children:Object(v.jsx)(q.b,{size:100})}),Object(v.jsx)("div",{style:{textAlign:"center",width:"100%"},children:"We have detected you are using a device with a narrow screen. This application is not designed for these types of devices, please try to use a laptop or desktop if you have access to one."})]})]})})}var Nt=function(){var e=Object(r.useState)(null),t=Object(o.a)(e,2),a=t[0],n=t[1],c=Object(r.useState)(null),s=Object(o.a)(c,2),i=s[0],l=s[1],d=Object(r.useState)(window.innerWidth),j=Object(o.a)(d,2),u=j[0],b=j[1],h=Object(r.useState)(!1),m=Object(o.a)(h,2),p=m[0],O=m[1];function f(){b(window.innerWidth)}return Object(r.useEffect)((function(){return window.addEventListener("resize",f),function(){window.removeEventListener("resize",f)}}),[]),Object(r.useEffect)((function(){O(u<=1e3)}),[u]),Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(g.ReactNotifications,{}),Object(v.jsx)(x.Provider,{value:[a,n],children:Object(v.jsx)(te.Provider,{value:[i,l],children:Object(v.jsx)("div",{className:"main-app-background",children:Object(v.jsx)("div",{className:"main-page",children:p?Object(v.jsx)(St,{}):Object(v.jsx)(kt,{})})})})})]})},_t=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,227)).then((function(t){var a=t.getCLS,r=t.getFID,n=t.getFCP,c=t.getLCP,s=t.getTTFB;a(e),r(e),n(e),c(e),s(e)}))};s.a.render(Object(v.jsx)(n.a.StrictMode,{children:Object(v.jsx)(Nt,{})}),document.getElementById("root")),_t()},60:function(e,t,a){}},[[208,1,2]]]);
//# sourceMappingURL=main.99466de1.chunk.js.map